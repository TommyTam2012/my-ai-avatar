<!-- TommySir Avatar + Centered Heygen Iframe (with Close Button + Safe Position) -->
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const existingAvatar = document.getElementById('floating-avatar');
    if (existingAvatar) return;

    /* === Floating Avatar Trigger (bottom-right, offset to avoid chatbot) === */
    const avatarIcon = document.createElement('div');
    avatarIcon.id = 'floating-avatar';
    avatarIcon.style.position = 'fixed';
    avatarIcon.style.bottom = '120px';   /* lift above chatbot */
    avatarIcon.style.right  = '160px';   /* move left to avoid overlap */
    avatarIcon.style.zIndex = '2147483647';
    avatarIcon.style.pointerEvents = 'auto';
    avatarIcon.innerHTML = `
      <img
        src="https://www.taeasla.com/image/TommySirAvatar.png"
        alt="與 Tommy Sir AI Avatar 聊天"
        style="width:140px;border-radius:12px;border:2px solid white;
               box-shadow:0 0 12px rgba(0,153,255,0.5);
               transition:transform .3s ease;cursor:pointer;"
        onmouseover="this.style.transform='scale(1.05)'"
        onmouseout="this.style.transform='scale(1)'"
        onclick="toggleHeygenIframe(true)"
      />
    `;
    document.body.appendChild(avatarIcon);

    /* === Centered Heygen Chat Window === */
    const avatarBox = document.createElement('div');
    avatarBox.id = 'heygen-iframe';
    avatarBox.style.display = 'none';
    avatarBox.style.position = 'fixed';
    avatarBox.style.top  = '50%';
    avatarBox.style.left = '50%';
    avatarBox.style.transform = 'translate(-50%, -50%)';
    avatarBox.style.width  = '420px';
    avatarBox.style.height = '640px';
    avatarBox.style.zIndex = '2147483647';
    avatarBox.style.borderRadius = '16px';
    avatarBox.style.overflow = 'hidden';
    avatarBox.style.boxShadow = '0 0 25px rgba(0,0,0,0.35)';
    avatarBox.style.background = '#000';

    avatarBox.innerHTML = `
      <div id="avatar-close-btn"
           style="position:absolute;top:6px;right:10px;
                  z-index:2147483648;font-size:22px;
                  color:#fff;cursor:pointer;
                  text-shadow:0 0 6px rgba(0,0,0,0.7);">
        ×
      </div>
      <iframe
        src="https://labs.heygen.com/guest/streaming-embed?share=YOUR_SHARE_TOKEN&inIFrame=1"
        width="100%"
        height="100%"
        frameborder="0"
        allow="microphone; camera; autoplay; clipboard-write"
        sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
        allowfullscreen
        style="border:none;border-radius:16px;">
      </iframe>
    `;
    document.body.appendChild(avatarBox);

    /* === Toggle open / close === */
    window.toggleHeygenIframe = function (open) {
      const box = document.getElementById('heygen-iframe');
      box.style.display =
        (open || box.style.display === 'none') ? 'block' : 'none';
    };

    /* === Close Button === */
    document.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'avatar-close-btn') {
        document.getElementById('heygen-iframe').style.display = 'none';
      }
    });
  });
</script>
<p>&nbsp;</p>
